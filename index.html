<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Horizon | Luxury Boutique Apartments</title>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts: Playfair Display + Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <!-- Firebase Compat -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>
    <style>
        /* ---------- LOADER ---------- */
        #loader { position: fixed; top:0; left:0; width:100%; height:100%; background:#fff; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:9999; transition:opacity 0.5s ease; font-family:'Playfair Display',serif; }
        #loader.fade-out { opacity:0; pointer-events:none; }
        .loader-logo { font-size:clamp(2rem,8vw,3rem); font-weight:700; color:#1a1a1a; letter-spacing:2px; margin-bottom:5px; }
        .loader-sub { font-size:clamp(1rem,4vw,1.5rem); color:#c9a86c; letter-spacing:2px; text-transform:uppercase; }
        .loader-spinner { font-size:clamp(1.5rem,5vw,2rem); color:#c9a86c; animation:spin 1s infinite linear; margin-top:20px; }
        @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }

        /* ---------- RESET & VARIABLES ---------- */
        * { margin:0; padding:0; box-sizing:border-box; }
        :root { --primary:#c9a86c; --primary-dark:#b48b4c; --dark:#1a1a1a; --gray:#2c2c2c; --light-gray:#f5f5f5; --text:#2c2c2c; --text-light:#666; --white:#ffffff; --shadow-sm:0 10px 30px -10px rgba(0,0,0,0.1); --shadow-md:0 20px 40px -15px rgba(0,0,0,0.2); --transition:all 0.3s ease; }
        body { font-family:'Inter',sans-serif; color:var(--text); line-height:1.6; background:var(--white); scroll-behavior:smooth; -webkit-tap-highlight-color:transparent; }
        h1,h2,h3,h4 { font-family:'Playfair Display',serif; font-weight:600; letter-spacing:-0.02em; }
        .container { width:90%; max-width:1400px; margin:0 auto; padding:80px 0; }
        @media (max-width:768px) { .container { padding:60px 0; } }

        /* ---------- HEADER ---------- */
        .site-header { position:absolute; top:0; left:0; width:100%; z-index:100; padding:15px 0; background:transparent; }
        .header-inner { display:flex; flex-direction:column; align-items:center; width:90%; max-width:1400px; margin:0 auto; gap:10px; }
        @media (min-width:769px) { .header-inner { flex-direction:row; justify-content:space-between; } }
        .logo { font-family:'Playfair Display',serif; font-size:24px; font-weight:700; color:white; text-shadow:0 4px 20px rgba(0,0,0,0.3); letter-spacing:1px; }
        @media (min-width:768px) { .logo { font-size:28px; } }

        /* mobile booking bar */
        .mobile-booking-bar { display:flex; flex-wrap:wrap; gap:8px; width:100%; background:rgba(255,255,255,0.2); backdrop-filter:blur(10px); border-radius:40px; padding:8px; border:1px solid rgba(255,255,255,0.3); }
        .mobile-booking-bar .booking-input { background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.3); padding:10px 12px; border-radius:40px; color:white; font-size:14px; flex:1 1 120px; min-width:0; }
        .mobile-booking-bar .book-btn { background:var(--primary); border:none; padding:10px 16px; border-radius:40px; color:var(--dark); font-weight:600; font-size:14px; cursor:pointer; white-space:nowrap; }
        @media (min-width:769px) { .mobile-booking-bar { display:none; } }

        .nav-menu { display:none; }
        @media (min-width:992px) { .nav-menu { display:flex; list-style:none; gap:40px; } }
        .nav-menu a { color:white; text-decoration:none; font-weight:500; font-size:15px; transition:var(--transition); text-shadow:0 2px 8px rgba(0,0,0,0.3); position:relative; }
        .nav-menu a::after { content:''; position:absolute; bottom:-4px; left:0; width:0%; height:2px; background:var(--primary); transition:var(--transition); }
        .nav-menu a:hover::after { width:100%; }

        /* hide hero booking bar on mobile */
        @media (max-width:768px) { .hero .booking-bar { display:none; } }

        /* ---------- HERO ---------- */
        .hero { height:100vh; min-height:600px; background:linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.2)), url('https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80') center/cover no-repeat; display:flex; align-items:center; text-align:center; color:white; position:relative; }
        .hero::before { content:''; position:absolute; bottom:0; left:0; width:100%; height:150px; background:linear-gradient(to top, rgba(0,0,0,0.4), transparent); z-index:1; }
        .hero-content { position:relative; z-index:2; max-width:1000px; margin:0 auto; padding:0 20px; width:100%; }
        .hero-subtitle { font-size:12px; letter-spacing:3px; text-transform:uppercase; margin-bottom:15px; font-weight:400; color:rgba(255,255,255,0.9); }
        @media (min-width:768px) { .hero-subtitle { font-size:14px; letter-spacing:4px; } }
        .hero h1 { font-size:clamp(2.2rem,8vw,5.5rem); margin-bottom:15px; line-height:1.1; font-weight:700; text-shadow:0 4px 30px rgba(0,0,0,0.3); }
        .hero p { font-size:1rem; margin-bottom:30px; font-weight:300; opacity:0.95; max-width:600px; margin-left:auto; margin-right:auto; }
        @media (min-width:768px) { .hero p { font-size:1.2rem; margin-bottom:40px; } }

        /* ---------- BOOKING BAR (desktop) ---------- */
        .booking-bar { background:rgba(255,255,255,0.15); backdrop-filter:blur(15px); border-radius:30px; padding:10px; display:flex; flex-direction:column; gap:10px; max-width:100%; margin:0 auto; border:1px solid rgba(255,255,255,0.2); box-shadow:0 20px 40px -10px rgba(0,0,0,0.3); }
        @media (min-width:768px) { .booking-bar { border-radius:60px; padding:8px; flex-direction:row; align-items:center; } }
        .booking-input { background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.3); padding:15px 20px; border-radius:50px; color:white; font-size:16px; width:100%; font-family:'Inter',sans-serif; transition:var(--transition); -webkit-appearance:none; }
        .booking-input:focus { outline:none; border-color:var(--primary); background:rgba(255,255,255,0.25); }
        .booking-input::placeholder { color:rgba(255,255,255,0.8); }
        .booking-input option { color:var(--dark); }
        .book-btn { background:var(--primary); border:none; padding:15px 25px; border-radius:50px; color:var(--dark); font-weight:600; cursor:pointer; transition:var(--transition); font-size:16px; letter-spacing:1px; box-shadow:0 8px 20px -8px rgba(201,168,108,0.5); width:100%; }
        @media (min-width:768px) { .book-btn { width:auto; padding:15px 40px; } }
        .book-btn:hover { background:var(--primary-dark); transform:translateY(-3px); box-shadow:0 15px 30px -8px rgba(201,168,108,0.7); }

        /* ---------- SECTION TITLES ---------- */
        .section-title { text-align:center; margin-bottom:50px; }
        .section-title .subtitle { font-size:12px; letter-spacing:2px; text-transform:uppercase; color:var(--primary); margin-bottom:10px; font-weight:500; }
        .section-title h2 { font-size:clamp(1.8rem,5vw,3.2rem); color:var(--dark); margin-bottom:15px; max-width:800px; margin-left:auto; margin-right:auto; }
        .section-title p { font-size:1rem; color:var(--text-light); max-width:700px; margin:0 auto; }
        @media (min-width:768px) { .section-title { margin-bottom:70px; } .section-title .subtitle { font-size:13px; letter-spacing:3px; } .section-title p { font-size:1.1rem; } }

        /* ---------- ABOUT ---------- */
        .about-grid { display:grid; grid-template-columns:1fr; gap:40px; align-items:center; }
        @media (min-width:992px) { .about-grid { grid-template-columns:1fr 1fr; gap:70px; } }
        .about-content h3 { font-size:clamp(1.8rem,4vw,2.8rem); margin-bottom:20px; color:var(--dark); }
        .about-content p { color:var(--text-light); margin-bottom:20px; font-size:1rem; line-height:1.8; }
        .about-image { border-radius:16px; overflow:hidden; box-shadow:var(--shadow-md); transform:perspective(1000px) rotateY(0deg); transition:var(--transition); }
        .about-image:hover { transform:perspective(1000px) rotateY(-2deg); }
        .about-image img { width:100%; height:auto; object-fit:cover; display:block; }

        /* ---------- GALLERY (first 9 images) ---------- */
        .gallery-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:15px; margin-top:30px; }
        @media (min-width:640px) { .gallery-grid { grid-template-columns:repeat(3,1fr); gap:20px; } }
        .gallery-card { background:white; border-radius:16px; overflow:hidden; box-shadow:var(--shadow-sm); transition:var(--transition); border:1px solid rgba(0,0,0,0.03); aspect-ratio:4/3; cursor:pointer; }
        .gallery-card:hover { transform:translateY(-5px); box-shadow:var(--shadow-md); }
        .gallery-card img { width:100%; height:100%; object-fit:cover; transition:var(--transition); display:block; }
        .gallery-card:hover img { transform:scale(1.03); }
        .gallery-plus-container { display:flex; justify-content:center; margin-top:30px; }
        .gallery-plus { width:60px; height:60px; background:var(--primary); border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-size:2rem; cursor:pointer; transition:var(--transition); box-shadow:var(--shadow-sm); }
        .gallery-plus:hover { background:var(--primary-dark); transform:scale(1.1) rotate(90deg); }

        /* ---------- DINING ---------- */
        .dining { background:var(--light-gray); }
        .dining-grid { display:grid; grid-template-columns:1fr; gap:40px; align-items:center; }
        @media (min-width:992px) { .dining-grid { grid-template-columns:1fr 1fr; gap:70px; } }
        .dining-image { border-radius:20px; overflow:hidden; box-shadow:var(--shadow-md); order:2; }
        @media (min-width:992px) { .dining-image { order:1; } }
        .dining-image img { width:100%; height:auto; object-fit:cover; display:block; }
        .dining-content { order:1; }
        @media (min-width:992px) { .dining-content { order:2; } }
        .dining-content h3 { font-size:clamp(1.8rem,4vw,2.8rem); margin-bottom:20px; color:var(--dark); }
        .dining-content p { color:var(--text-light); margin-bottom:20px; line-height:1.8; font-size:1rem; }

        /* ---------- SERVICES ---------- */
        .services-grid { display:grid; grid-template-columns:1fr; gap:25px; margin-top:30px; }
        @media (min-width:640px) { .services-grid { grid-template-columns:repeat(2,1fr); gap:30px; } }
        @media (min-width:1024px) { .services-grid { grid-template-columns:repeat(3,1fr); gap:40px; } }
        .service-card { text-align:center; padding:30px 20px; background:white; border-radius:20px; box-shadow:var(--shadow-sm); transition:var(--transition); border:1px solid rgba(0,0,0,0.02); }
        .service-card:hover { transform:translateY(-5px); box-shadow:var(--shadow-md); }
        .service-card i { font-size:2.5rem; color:var(--primary); margin-bottom:15px; }
        .service-card h3 { font-size:1.3rem; margin-bottom:10px; }
        .service-card p { color:var(--text-light); font-size:0.95rem; }
        @media (min-width:768px) { .service-card { padding:40px 25px; } .service-card i { font-size:3.2rem; } .service-card h3 { font-size:1.5rem; } }

        /* ---------- TESTIMONIALS CAROUSEL ---------- */
        .testimonials { background:var(--dark); color:white; position:relative; overflow:hidden; padding:60px 0; }
        .testimonials .section-title h2, .testimonials .section-title p { color:white; }
        .testimonials-carousel { position:relative; max-width:900px; margin:0 auto; padding:0 40px; }
        .testimonials-track { display:flex; overflow-x:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch; gap:20px; padding-bottom:10px; scrollbar-width:thin; scrollbar-color:var(--primary) #333; }
        .testimonials-track::-webkit-scrollbar { height:6px; }
        .testimonials-track::-webkit-scrollbar-thumb { background:var(--primary); border-radius:10px; }
        .testimonials-track::-webkit-scrollbar-track { background:#333; border-radius:10px; }
        .testimonial-card { flex:0 0 calc(100% - 20px); scroll-snap-align:start; background:rgba(255,255,255,0.03); backdrop-filter:blur(10px); border-radius:20px; padding:25px 20px; border:1px solid rgba(255,255,255,0.05); text-align:center; transition:var(--transition); }
        @media (min-width:768px) { .testimonial-card { flex:0 0 calc(33.333% - 14px); } }
        .testimonial-card i { font-size:2rem; color:var(--primary); margin-bottom:15px; opacity:0.5; }
        .testimonial-card p { font-size:1rem; font-family:'Playfair Display',serif; margin-bottom:15px; line-height:1.5; font-style:italic; word-break:break-word; }
        .testimonial-author { font-weight:600; color:var(--primary); }
        .carousel-arrow { position:absolute; top:50%; transform:translateY(-50%); width:40px; height:40px; background:var(--primary); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--dark); cursor:pointer; transition:var(--transition); z-index:10; border:none; font-size:1.2rem; }
        .carousel-arrow:hover { background:var(--primary-dark); transform:translateY(-50%) scale(1.1); }
        .carousel-arrow.left { left:0; } .carousel-arrow.right { right:0; }

        /* ---------- TOURS ---------- */
        .tours-grid { display:grid; grid-template-columns:1fr; gap:20px; margin-top:30px; }
        @media (min-width:640px) { .tours-grid { grid-template-columns:repeat(2,1fr); gap:25px; } }
        @media (min-width:1024px) { .tours-grid { grid-template-columns:repeat(3,1fr); gap:30px; } }
        .tour-card { background:white; border-radius:20px; overflow:hidden; box-shadow:var(--shadow-sm); transition:var(--transition); }
        .tour-card:hover { transform:translateY(-5px); box-shadow:var(--shadow-md); }
        .tour-card img { width:100%; height:200px; object-fit:cover; }
        .tour-info { padding:20px; } .tour-info h4 { font-size:1.3rem; margin-bottom:8px; } .tour-info p { color:var(--text-light); font-size:0.95rem; }

        /* ---------- PREMIUM 3D SOCIAL TILES ---------- */
        .social-tiles-wrapper { text-align:center; margin-bottom:40px; }
        .social-tiles-wrapper h3 { font-family:'Playfair Display',serif; font-size:2rem; color:var(--dark); margin-bottom:30px; font-weight:600; }
        .premium-social-container { display:flex; flex-wrap:wrap; justify-content:center; align-items:center; gap:2.5rem; perspective:1200px; }
        .premium-social-tile { position:relative; width:160px; height:160px; border-radius:16px; display:flex; flex-direction:column; justify-content:center; align-items:center; text-decoration:none; color:#2c2c2c; background:rgba(255,255,255,0.9); backdrop-filter:blur(8px); border:1px solid rgba(0,0,0,0.05); box-shadow:0 20px 40px -10px rgba(0,0,0,0.25), 0 0 0 1px rgba(0,0,0,0.02) inset; transform-style:preserve-3d; transition:transform 0.4s ease, box-shadow 0.4s ease; will-change:transform; overflow:hidden; }
        .premium-social-tile::before { content:''; position:absolute; top:-50%; left:-50%; width:200%; height:200%; background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%); opacity:0.4; transition:opacity 0.4s ease; pointer-events:none; z-index:1; mix-blend-mode:soft-light; }
        .premium-social-tile.instagram { background:linear-gradient(145deg,#fff9fb,#ffffff); border-color:rgba(225,48,108,0.2); }
        .premium-social-tile.facebook { background:linear-gradient(145deg,#f5f8ff,#ffffff); border-color:rgba(66,103,178,0.2); }
        .premium-social-tile i { font-size:3.5rem; margin-bottom:0.5rem; filter:drop-shadow(0 2px 4px rgba(0,0,0,0.05)); transition:transform 0.3s ease; z-index:2; position:relative; }
        .premium-social-tile.instagram i { color:#e1306c; } .premium-social-tile.facebook i { color:#4267B2; }
        .premium-social-tile span { font-weight:500; font-size:1.1rem; letter-spacing:2px; text-transform:uppercase; text-shadow:0 1px 2px rgba(0,0,0,0.02); z-index:2; position:relative; background:rgba(255,255,255,0.7); padding:0.2rem 0.8rem; border-radius:30px; backdrop-filter:blur(4px); border:1px solid rgba(0,0,0,0.05); font-family:'Playfair Display',serif; font-weight:600; color:#2c2c2c; }
        .premium-social-tile:hover { transform:translateY(-8px) rotateX(2deg) rotateY(2deg) scale(1.02); box-shadow:0 40px 50px -15px rgba(0,0,0,0.3), 0 0 0 1px rgba(0,0,0,0.04) inset; }
        .premium-social-tile:hover::before { opacity:0.6; } .premium-social-tile:hover i { transform:translateY(-2px); filter:drop-shadow(0 6px 8px rgba(0,0,0,0.15)); }
        @media (max-width:700px) { .premium-social-container { gap:1.5rem; } .premium-social-tile { width:130px; height:130px; } .premium-social-tile i { font-size:2.8rem; } .premium-social-tile span { font-size:0.9rem; } }

        /* ---------- FOOTER ---------- */
        footer { background:var(--dark); color:#aaa; padding:60px 0 30px; }
        .footer-grid { display:grid; grid-template-columns:1fr; gap:40px; margin-bottom:40px; }
        @media (min-width:768px) { .footer-grid { grid-template-columns:repeat(2,1fr); gap:50px; } }
        @media (min-width:1024px) { .footer-grid { grid-template-columns:repeat(3,1fr); } }
        .footer-col h4 { color:white; margin-bottom:20px; font-size:1.2rem; letter-spacing:0.5px; }
        .footer-col p, .footer-col a { color:#aaa; text-decoration:none; line-height:2; transition:var(--transition); font-size:0.95rem; }
        .footer-col a:hover { color:var(--primary); }
        .copyright { text-align:center; border-top:1px solid #333; padding-top:30px; color:#666; font-size:0.9rem; }

        /* ---------- ADMIN ICON ---------- */
        .admin-icon { position:fixed; bottom:20px; right:20px; width:56px; height:56px; background:var(--primary); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--dark); font-size:24px; cursor:pointer; box-shadow:0 8px 25px rgba(0,0,0,0.25); z-index:1000; transition:var(--transition); border:2px solid rgba(255,255,255,0.2); }
        .admin-icon:hover { transform:rotate(30deg) scale(1.1); background:var(--primary-dark); }

        /* ---------- ADMIN OVERLAY ---------- */
        .admin-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); backdrop-filter:blur(8px); z-index:2000; display:none; justify-content:center; align-items:center; padding:10px; }
        .admin-panel { background:#f8f9fc; width:100%; max-width:1200px; max-height:95vh; border-radius:24px; padding:20px; overflow-y:auto; position:relative; box-shadow:0 30px 60px rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.1); }
        @media (min-width:768px) { .admin-panel { padding:30px; } }
        .admin-panel h2 { margin-bottom:20px; color:var(--dark); font-size:1.8rem; }
        /* login */
        .login-form { max-width:400px; margin:30px auto; text-align:center; background:white; padding:30px 20px; border-radius:24px; box-shadow:var(--shadow-md); }
        .login-form input { width:100%; padding:14px; margin:10px 0; border:1px solid #ddd; border-radius:40px; font-family:'Inter',sans-serif; font-size:16px; }
        .login-form button { width:100%; padding:14px; background:var(--primary); color:var(--dark); border:none; border-radius:40px; font-weight:600; cursor:pointer; margin-top:10px; transition:var(--transition); font-size:16px; }
        .login-form button:hover { background:var(--primary-dark); } .login-form .error { color:red; margin-top:10px; }

        /* admin tabs */
        .admin-tabs { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:20px; background:white; padding:15px; border-radius:40px; box-shadow:0 5px 15px rgba(0,0,0,0.05); }
        .admin-tab { padding:8px 16px; background:#f0f0f0; border-radius:40px; cursor:pointer; font-weight:500; transition:var(--transition); font-size:0.9rem; }
        .admin-tab.active { background:var(--primary); color:white; }
        .admin-tab-content { display:none; background:white; padding:20px; border-radius:24px; box-shadow:0 10px 25px rgba(0,0,0,0.03); }
        .admin-tab-content.active { display:block; }
        .admin-field { margin-bottom:20px; }
        .admin-field label { display:block; font-weight:600; margin-bottom:8px; color:#444; font-size:0.95rem; }
        .admin-field input, .admin-field textarea, .admin-field select { width:100%; padding:12px 16px; border:1px solid #e0e0e0; border-radius:16px; font-family:'Inter',sans-serif; transition:var(--transition); background:#fafafa; font-size:16px; }
        .admin-field input:focus, .admin-field textarea:focus { border-color:var(--primary); outline:none; background:white; }
        .admin-field textarea { min-height:100px; }
        .image-upload-row { display:flex; flex-direction:column; gap:10px; margin-bottom:10px; }
        @media (min-width:768px) { .image-upload-row { flex-direction:row; align-items:center; } }
        .image-upload-row input { flex:1; width:100%; }
        .upload-btn { background:var(--primary); color:var(--dark); border:none; padding:10px 24px; border-radius:40px; cursor:pointer; font-size:0.9rem; font-weight:500; transition:var(--transition); white-space:nowrap; }
        .upload-btn:hover { background:var(--primary-dark); } .upload-btn:disabled { background:#ccc; cursor:not-allowed; }
        .image-preview { max-width:100px; max-height:80px; object-fit:cover; border-radius:12px; margin-top:8px; border:2px solid #eee; box-shadow:0 5px 10px rgba(0,0,0,0.1); }
        .thumbnail-list { display:flex; flex-direction:column; gap:20px; margin-bottom:15px; }
        .thumbnail-item { display:flex; flex-direction:column; gap:15px; border-bottom:1px solid #eee; padding-bottom:20px; background:#f9f9f9; border-radius:20px; padding:20px; }
        @media (min-width:768px) { .thumbnail-item { flex-direction:row; align-items:flex-start; } }
        .thumbnail-item .image-upload-row { width:100%; }
        .thumbnail-item button { background:#ff4d4d; color:white; border:none; width:40px; height:40px; border-radius:50%; cursor:pointer; transition:var(--transition); align-self:flex-end; }
        .thumbnail-item button:hover { background:#cc0000; }
        .add-btn { background:#4CAF50; color:white; border:none; padding:12px 24px; border-radius:40px; cursor:pointer; margin-top:15px; font-weight:500; transition:var(--transition); width:100%; }
        @media (min-width:768px) { .add-btn { width:auto; } }
        .add-btn:hover { background:#45a049; }
        .admin-buttons { display:flex; flex-direction:column; gap:10px; margin-top:30px; }
        @media (min-width:768px) { .admin-buttons { flex-direction:row; gap:15px; justify-content:flex-end; } }
        .admin-buttons button { padding:14px 24px; border:none; border-radius:40px; font-weight:600; cursor:pointer; transition:var(--transition); width:100%; }
        @media (min-width:768px) { .admin-buttons button { width:auto; } }
        .btn-save { background:var(--primary); color:var(--dark); } .btn-save:hover { background:var(--primary-dark); }
        .btn-close { background:#ddd; color:#333; } .btn-close:hover { background:#ccc; }
        .btn-logout { background:#ff4d4d; color:white; border:none; padding:10px 20px; border-radius:40px; cursor:pointer; font-weight:500; } .btn-logout:hover { background:#cc0000; }

        /* calendar grid */
        .calendar-day { background:#f9f9f9; border-radius:12px; padding:8px; text-align:center; border:1px solid #eee; }
        .calendar-day .day-number { font-weight:600; margin-bottom:5px; }
        .calendar-day input[type="checkbox"] { margin-right:5px; transform:scale(1.2); }
        .calendar-day input[type="number"] { width:70px; padding:4px; border-radius:20px; border:1px solid #ccc; text-align:center; font-size:0.9rem; }
        @media (min-width:768px) { .calendar-day input[type="number"] { width:80px; } }

        /* reservation list */
        .reservation-item { background:#f9f9f9; border-radius:16px; padding:15px; margin-bottom:15px; display:flex; flex-direction:column; gap:10px; }
        @media (min-width:768px) { .reservation-item { flex-direction:row; justify-content:space-between; align-items:center; } }
        .reservation-details { flex:1; }
        .reservation-actions { display:flex; gap:8px; flex-wrap:wrap; }
        .reservation-actions button { background:#ff4d4d; color:white; border:none; padding:8px 16px; border-radius:30px; cursor:pointer; font-size:0.9rem; }
        .reservation-actions button.confirm-btn { background:#4CAF50; }
        .reservation-actions button.confirm-btn:hover { background:#45a049; }
        .reservation-actions button:hover { background:#cc0000; }
        .status-badge { display:inline-block; padding:4px 8px; border-radius:20px; font-size:0.8rem; font-weight:600; margin-right:8px; }
        .status-inquiry { background:#ffc107; color:#333; }
        .status-confirmed { background:#4CAF50; color:white; }

        /* booking modal */
        .booking-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); backdrop-filter:blur(5px); z-index:3000; justify-content:center; align-items:center; padding:10px; }
        .modal-content { background:white; border-radius:30px; padding:30px 20px; max-width:450px; width:100%; box-shadow:0 30px 60px rgba(0,0,0,0.5); position:relative; max-height:90vh; overflow-y:auto; }
        .modal-content h3 { font-size:1.8rem; margin-bottom:20px; color:var(--dark); }
        .modal-content .close-modal { position:absolute; top:15px; right:20px; font-size:28px; cursor:pointer; color:#aaa; transition:var(--transition); }
        .modal-content .close-modal:hover { color:var(--dark); }
        .modal-field { margin-bottom:20px; } .modal-field label { display:block; font-weight:600; margin-bottom:5px; color:#444; }
        .modal-field input { width:100%; padding:12px 18px; border:1px solid #ddd; border-radius:30px; font-family:'Inter',sans-serif; font-size:16px; }
        .modal-field input:focus { outline:none; border-color:var(--primary); }
        .modal-field .readonly-input { background:#f0f0f0; color:#555; }
        .modal-submit { background:var(--primary); color:var(--dark); border:none; padding:15px 30px; border-radius:40px; font-weight:600; width:100%; cursor:pointer; transition:var(--transition); font-size:16px; margin-top:10px; }
        .modal-submit:hover { background:var(--primary-dark); transform:translateY(-2px); }

        /* full gallery modal */
        .full-gallery-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:4000; justify-content:center; align-items:flex-start; padding:20px; overflow-y:auto; }
        .full-gallery-content { background:transparent; width:100%; max-width:1200px; position:relative; margin:40px auto; }
        .full-gallery-close { position:sticky; top:10px; float:right; width:50px; height:50px; background:var(--primary); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--dark); font-size:2rem; cursor:pointer; transition:var(--transition); z-index:10; border:2px solid white; box-shadow:0 4px 15px rgba(0,0,0,0.3); }
        .full-gallery-close:hover { background:var(--primary-dark); transform:scale(1.1) rotate(90deg); }
        .full-gallery-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(250px,1fr)); gap:20px; margin-top:70px; clear:both; }
        .full-gallery-grid img { width:100%; height:250px; object-fit:cover; border-radius:16px; transition:var(--transition); cursor:pointer; border:2px solid transparent; }
        .full-gallery-grid img:hover { transform:scale(1.02); border-color:var(--primary); }
        .full-gallery-close-bottom { display:block; width:fit-content; margin:30px auto 0; padding:12px 30px; background:var(--primary); color:var(--dark); border:none; border-radius:40px; font-weight:600; cursor:pointer; transition:var(--transition); font-size:1.1rem; }
        .full-gallery-close-bottom:hover { background:var(--primary-dark); transform:scale(1.05); }

        /* lightbox */
        .lightbox-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:5000; justify-content:center; align-items:center; padding:20px; }
        .lightbox-content { max-width:90vw; max-height:90vh; object-fit:contain; border-radius:8px; box-shadow:0 20px 40px rgba(0,0,0,0.5); }
        .lightbox-close { position:absolute; top:20px; right:30px; color:white; font-size:40px; font-weight:bold; cursor:pointer; transition:0.3s; z-index:5010; }
        .lightbox-close:hover { color:var(--primary); }

        /* gallery order drag & drop */
        .gallery-order-list { display:flex; flex-direction:column; gap:10px; margin-top:20px; }
        .gallery-order-item { display:flex; align-items:center; gap:15px; padding:10px; background:#f9f9f9; border-radius:12px; border:1px solid #eee; cursor:move; transition:background 0.2s; }
        .gallery-order-item:hover { background:#f0f0f0; }
        .gallery-order-item .drag-handle { font-size:1.5rem; color:#aaa; cursor:grab; }
        .gallery-order-item .thumbnail { width:60px; height:60px; object-fit:cover; border-radius:8px; }
        .gallery-order-item .title { font-weight:500; }
    </style>
</head>
<body>
    <!-- LOADER -->
    <div id="loader"><div class="loader-logo">Horizon</div><div class="loader-sub">Luxury Living</div><div class="loader-spinner"><i class="fas fa-spinner"></i></div></div>

    <!-- Header -->
    <header class="site-header">
        <div class="header-inner">
            <div class="logo" id="site-logo">Horizon</div>
            <!-- Mobile booking bar -->
            <div class="mobile-booking-bar" id="mobileBookingBar">
                <input type="date" class="booking-input" id="mobile-booking-checkin">
                <input type="date" class="booking-input" id="mobile-booking-checkout">
                <select class="booking-input" id="mobile-booking-guests"></select>
                <button class="book-btn" id="mobile-book-btn">Send Inquiry</button>
            </div>
            <nav><ul class="nav-menu" id="nav-menu"></ul></nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="hero">
        <div class="hero-content">
            <div class="hero-subtitle" id="hero-subtitle">Welcome to Horizon, a luxury apartment in the heart of the city</div>
            <h1 id="hero-title">Your Next Boutique Apartment</h1>
            <p id="hero-text">Stay in the heart of the city</p>
            <div class="booking-bar">
                <input type="date" class="booking-input" id="booking-checkin">
                <input type="date" class="booking-input" id="booking-checkout">
                <select class="booking-input" id="booking-guests"></select>
                <button class="book-btn" id="book-btn">Check Availability & Send Inquiry</button>
            </div>
        </div>
    </section>

    <!-- Main Content (dynamic) -->
    <main id="main-content"></main>

    <!-- Social Tiles -->
    <div class="container" style="padding-bottom:20px;">
        <div class="social-tiles-wrapper">
            <h3>Connect With Us</h3>
            <div class="premium-social-container">
                <a href="#" class="premium-social-tile instagram" target="_blank"><i class="fab fa-instagram"></i><span>Instagram</span></a>
                <a href="#" class="premium-social-tile facebook" target="_blank"><i class="fab fa-facebook-f"></i><span>Facebook</span></a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-grid" id="footer-grid"></div>
            <div class="copyright" id="copyright"></div>
        </div>
    </footer>

    <!-- Admin Icon -->
    <div class="admin-icon" id="adminIcon"><i class="fas fa-pen-to-square"></i></div>

    <!-- Admin Overlay (full structure) -->
    <div class="admin-overlay" id="adminOverlay">
        <div class="admin-panel" id="adminPanel">
            <!-- Login -->
            <div id="loginContainer">
                <h2 style="text-align:center;">Admin Login</h2>
                <div class="login-form">
                    <input type="email" id="loginEmail" placeholder="Email" value="admin@example.com">
                    <input type="password" id="loginPassword" placeholder="Password">
                    <button id="loginBtn">Login</button>
                    <div id="loginError" class="error"></div>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="adminDashboard" style="display:none;">
                <div style="display:flex; flex-direction:column; gap:15px; margin-bottom:20px;">
                    <h2><i class="fas fa-crown" style="color:var(--primary);"></i> Dashboard</h2>
                    <button class="btn-logout" id="logoutBtn" style="align-self:flex-start;">Logout</button>
                </div>
                <div class="admin-tabs">
                    <div class="admin-tab active" data-tab="hero">Hero</div>
                    <div class="admin-tab" data-tab="about">About</div>
                    <div class="admin-tab" data-tab="gallery">Gallery</div>
                    <div class="admin-tab" data-tab="galleryOrder">Gallery Order</div>
                    <div class="admin-tab" data-tab="pricing">Pricing</div>
                    <div class="admin-tab" data-tab="dining">Dining</div>
                    <div class="admin-tab" data-tab="services">Services</div>
                    <div class="admin-tab" data-tab="testimonials">Testimonials</div>
                    <div class="admin-tab" data-tab="tours">Tours</div>
                    <div class="admin-tab" data-tab="calendar">Calendar</div>
                    <div class="admin-tab" data-tab="reservations">Reservations</div>
                    <div class="admin-tab" data-tab="menu">Menu</div>
                    <div class="admin-tab" data-tab="settings">Settings</div>
                    <div class="admin-tab" data-tab="sync">Calendar Sync</div>
                    <div class="admin-tab" data-tab="footer">Footer</div>
                </div>

                <!-- Hero Tab -->
                <div class="admin-tab-content active" id="tab-hero">
                    <div class="admin-field"><label>Subtitle</label><input type="text" id="hero-subtitle-input"></div>
                    <div class="admin-field"><label>Title</label><input type="text" id="hero-title-input"></div>
                    <div class="admin-field"><label>Text</label><input type="text" id="hero-text-input"></div>
                    <div class="admin-field"><label>Background Image</label><div class="image-upload-row"><input type="url" id="hero-bg-input"><button class="upload-btn" id="upload-hero-bg">Upload</button></div><img id="hero-bg-preview" class="image-preview" style="display:none;"></div>
                    <div class="admin-field"><label>Default Check-In</label><input type="date" id="hero-checkin-input"></div>
                    <div class="admin-field"><label>Default Check-Out</label><input type="date" id="hero-checkout-input"></div>
                </div>
                <!-- About Tab -->
                <div class="admin-tab-content" id="tab-about">
                    <div class="admin-field"><label>Title</label><input type="text" id="about-title-input"></div>
                    <div class="admin-field"><label>Description 1</label><textarea id="about-desc1-input"></textarea></div>
                    <div class="admin-field"><label>Description 2</label><textarea id="about-desc2-input"></textarea></div>
                    <div class="admin-field"><label>Image</label><div class="image-upload-row"><input type="url" id="about-image-input"><button class="upload-btn" id="upload-about-image">Upload</button></div><img id="about-image-preview" class="image-preview" style="display:none;"></div>
                </div>
                <!-- Gallery Tab -->
                <div class="admin-tab-content" id="tab-gallery">
                    <div id="gallery-list"></div>
                    <button class="add-btn" id="add-gallery-image">+ Add Image</button>
                </div>
                <!-- Gallery Order Tab -->
                <div class="admin-tab-content" id="tab-galleryOrder">
                    <p>Drag and drop to reorder gallery images. Changes are saved when you click "Save Changes".</p>
                    <div id="gallery-order-list" class="gallery-order-list"></div>
                </div>
                <!-- Pricing Tab -->
                <div class="admin-tab-content" id="tab-pricing">
                    <div class="admin-field"><label>Base Price ($)</label><input type="number" id="pricing-basePrice"></div>
                    <div class="admin-field"><label>Max Guests</label><input type="number" id="pricing-maxGuests"></div>
                    <div class="admin-field"><label>Extra Guest Fee ($)</label><input type="number" id="pricing-extraFee"></div>
                    <hr><h3>Bulk Date Pricing</h3>
                    <div class="admin-field"><label>From</label><input type="date" id="bulk-from"></div>
                    <div class="admin-field"><label>To</label><input type="date" id="bulk-to"></div>
                    <div class="admin-field"><label>Set Price ($)</label><input type="number" id="bulk-price"></div>
                    <button class="upload-btn" id="apply-bulk-pricing">Apply to Selected Dates</button>
                </div>
                <!-- Dining Tab -->
                <div class="admin-tab-content" id="tab-dining">
                    <div class="admin-field"><label>Title</label><input type="text" id="dining-title-input"></div>
                    <div class="admin-field"><label>Description</label><textarea id="dining-desc-input"></textarea></div>
                    <div class="admin-field"><label>Image</label><div class="image-upload-row"><input type="url" id="dining-image-input"><button class="upload-btn" id="upload-dining-image">Upload</button></div><img id="dining-image-preview" class="image-preview" style="display:none;"></div>
                </div>
                <!-- Services Tab -->
                <div class="admin-tab-content" id="tab-services">
                    <div id="services-list"></div>
                    <button class="add-btn" id="add-service">+ Add Service</button>
                </div>
                <!-- Testimonials Tab -->
                <div class="admin-tab-content" id="tab-testimonials">
                    <div id="testimonials-list"></div>
                    <button class="add-btn" id="add-testimonial">+ Add Testimonial</button>
                </div>
                <!-- Tours Tab -->
                <div class="admin-tab-content" id="tab-tours">
                    <div class="admin-field"><label>Tours Title</label><input type="text" id="tours-title-input"></div>
                    <div class="admin-field"><label>Tours Description</label><textarea id="tours-desc-input"></textarea></div>
                    <div id="tours-list"></div>
                    <button class="add-btn" id="add-tour">+ Add Tour</button>
                </div>
                <!-- Calendar Tab -->
                <div class="admin-tab-content" id="tab-calendar">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin:20px 0; flex-wrap:wrap; gap:10px;">
                        <button class="upload-btn" id="calendar-prev-month"><i class="fas fa-chevron-left"></i> Prev</button>
                        <span id="calendar-month-year"></span>
                        <button class="upload-btn" id="calendar-next-month">Next <i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div id="calendar-grid" style="display:grid; grid-template-columns:repeat(7,1fr); gap:5px;"></div>
                    <p style="margin-top:10px;">âœ“ = available</p>
                </div>
                <!-- Reservations Tab -->
                <div class="admin-tab-content" id="tab-reservations">
                    <div id="reservations-list"></div>
                </div>
                <!-- Menu Tab -->
                <div class="admin-tab-content" id="tab-menu">
                    <div id="menu-list"></div>
                    <button class="add-btn" id="add-menu-item">+ Add Menu Item</button>
                </div>
                <!-- Settings Tab -->
                <div class="admin-tab-content" id="tab-settings">
                    <div class="admin-field"><label>Primary Color</label><input type="color" id="settings-color" value="#c9a86c"></div>
                    <div class="admin-field"><label>Font Family</label><select id="settings-font"><option value="'Inter', sans-serif">Inter</option><option value="'Open Sans', sans-serif">Open Sans</option><option value="'Roboto', sans-serif">Roboto</option></select></div>
                    <div class="admin-field"><label>Max Guests</label><input type="number" id="settings-maxGuests" value="12"></div>
                    <hr><h3>Social Media Links</h3>
                    <div class="admin-field"><label>Instagram URL</label><input type="url" id="settings-social-instagram" placeholder="https://instagram.com/..."></div>
                    <div class="admin-field"><label>Facebook URL</label><input type="url" id="settings-social-facebook" placeholder="https://facebook.com/..."></div>
                    <hr><h3>Email Notifications</h3>
                    <div class="admin-field"><label>Admin Email</label><input type="email" id="settings-adminEmail"></div>
                    <div class="admin-field"><label>EmailJS Public Key</label><input type="text" id="settings-emailjs-public"></div>
                    <div class="admin-field"><label>EmailJS Service ID</label><input type="text" id="settings-emailjs-service"></div>
                    <div class="admin-field"><label>EmailJS Template ID</label><input type="text" id="settings-emailjs-template"></div>
                </div>
                <!-- Calendar Sync Tab -->
                <div class="admin-tab-content" id="tab-sync">
                    <h3>Export iCal</h3>
                    <button class="upload-btn" id="export-ical">ðŸ“… Download iCal File</button>
                    <hr><h3>Import iCal</h3>
                    <div class="admin-field"><label>iCal URL</label><input type="url" id="ical-import-url"></div>
                    <button class="upload-btn" id="import-ical">ðŸ”„ Sync from iCal</button>
                    <div id="import-result"></div>
                </div>
                <!-- Footer Tab -->
                <div class="admin-tab-content" id="tab-footer">
                    <div class="admin-field"><label>Copyright</label><input type="text" id="copyright-input"></div>
                    <div class="admin-field"><label>Address</label><input type="text" id="footer-address"></div>
                    <div class="admin-field"><label>Phone</label><input type="text" id="footer-phone"></div>
                    <div class="admin-field"><label>Email</label><input type="email" id="footer-email"></div>
                </div>

                <div class="admin-buttons">
                    <button class="btn-save" id="saveChanges">Save Changes</button>
                    <button class="btn-close" id="closeAdmin">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div class="booking-modal" id="bookingModal">
        <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            <h3>Send an inquiry</h3>
            <form id="booking-form">
                <div class="modal-field"><label>First Name</label><input type="text" id="modal-firstname" required></div>
                <div class="modal-field"><label>Last Name</label><input type="text" id="modal-lastname" required></div>
                <div class="modal-field"><label>Email</label><input type="email" id="modal-email" required></div>
                <div class="modal-field"><label>Phone</label><input type="tel" id="modal-phone" required></div>
                <div class="modal-field"><label>Check-in</label><input type="text" id="modal-checkin" class="readonly-input" readonly></div>
                <div class="modal-field"><label>Check-out</label><input type="text" id="modal-checkout" class="readonly-input" readonly></div>
                <div class="modal-field"><label>Guests</label><input type="text" id="modal-guests" class="readonly-input" readonly></div>
                <div class="modal-field"><label>Estimated total</label><input type="text" id="modal-total" class="readonly-input" readonly></div>
                <button type="submit" class="modal-submit">Send Inquiry</button>
                <p style="font-size:0.8rem; margin-top:10px; color:#666;">You will be contacted shortly to confirm availability.</p>
            </form>
        </div>
    </div>

    <!-- Full Gallery Modal -->
    <div class="full-gallery-modal" id="fullGalleryModal">
        <div class="full-gallery-content">
            <div class="full-gallery-close" id="closeFullGallery">&times;</div>
            <div class="full-gallery-grid" id="fullGalleryGrid"></div>
            <button class="full-gallery-close-bottom" id="closeFullGalleryBottom">Close Gallery</button>
        </div>
    </div>

    <!-- Lightbox Modal -->
    <div class="lightbox-modal" id="lightboxModal">
        <span class="lightbox-close" id="lightboxClose">&times;</span>
        <img class="lightbox-content" id="lightboxImage" src="" alt="Enlarged view">
    </div>

    <script>
        (function() {
            // Record start time for minimum 4s loader
            const startTime = Date.now();

            // ---------- FIREBASE CONFIG ----------
            const firebaseConfig = {
                apiKey: "AIzaSyBMzcjbqruiE_nJXhEfUWaASHbKE8YM60E",
                authDomain: "horizonluxury-18b60.firebaseapp.com",
                projectId: "horizonluxury-18b60",
                storageBucket: "horizonluxury-18b60.appspot.com",
                messagingSenderId: "521174900591",
                appId: "1:521174900591:web:e7773cdd8052a6214b529a"
            };
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();
            const storage = firebase.storage();
            const contentDoc = db.collection('website').doc('content');
            const reservationsCol = db.collection('reservations');

            let emailjsInitialized = false;
            function initEmailJS(publicKey) { if(publicKey) { emailjs.init(publicKey); emailjsInitialized = true; } }

            // ---------- DEFAULT DATA ----------
            const defaultData = {
                hero: {
                    subtitle: "Welcome to Horizon, a luxury apartment in the heart of the city",
                    title: "Your Next Boutique Apartment",
                    text: "Stay in the heart of the city",
                    bgImage: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80",
                    checkIn: "", checkOut: ""
                },
                about: {
                    title: "Luxury furnished serviced apartment in the city center",
                    desc1: "Located in the heart of the city, Horizon apartment hotel provides a peaceful, private retreat in the heart of one of the world's most iconic cities. Experience a sophisticated blend of professional services and home comforts.",
                    desc2: "We proudly offers a full range of complimentary amenities and services that provide you with everything you need for an inspiring stay.",
                    image: "https://images.unsplash.com/photo-1566665797739-1674de7a421a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1974&q=80"
                },
                gallery: [
                    { title:"Living Room", desc:"Cozy space", image:"https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80" },
                    { title:"Bedroom", desc:"Spacious bedroom", image:"https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80" },
                    { title:"Kitchen", desc:"Modern kitchen", image:"https://images.unsplash.com/photo-1512918728675-ed5a9ecdebfd?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80" }
                ],
                pricing: [ { basePrice:199, maxGuests:2, extraGuestFee:20 } ],
                dining: {
                    title:"Experience exquisite cuisine from all over the world",
                    desc:"Our experienced chefs create international specialties with unique flavors. Relax with gourmet cuisine and signature cocktails or homemade tonics, all enhanced by beautiful music and gorgeous views over the city. From seasonal menus to dining experiences to satisfy any craving, see what our chefs are preparing for you.",
                    image:"https://images.unsplash.com/photo-1414235077428-338989a2e8c0?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80"
                },
                services: [
                    { icon:"fas fa-briefcase", title:"Meeting Spaces", desc:"Three intimate meeting rooms with wireless Internet and speakerphone." },
                    { icon:"fas fa-spa", title:"Spa & Wellness", desc:"Exceptional well-being experience combining expertise and high technology." },
                    { icon:"fas fa-dumbbell", title:"Fitness Center", desc:"Fully equipped gym, yoga room and dance studio with stunning views." }
                ],
                testimonials: [
                    { text:"The hotel is well located. Rooms are very clean. Great services. Very kind people from front desk and delicious breakfast. And I really love the spa!", author:"Sarah Johnson" },
                    { text:"Amazing experience! The staff went above and beyond to make our stay memorable.", author:"Michael Chen" },
                    { text:"Perfect location, beautiful rooms, and exceptional service. Will definitely return!", author:"Emma Williams" }
                ],
                tours: {
                    title:"Discover The City",
                    desc:"You are in a city where people are never bored. Immerse yourself in local art exhibitions, neighbourhood events, seasonal activities and numerous parks.",
                    items: [
                        { title:"Exhibitions & Museum", desc:"Don't miss the excellent art exhibitions coming up. Traditional paintings, transformative sculptures, interactive art exhibits.", image:"https://images.unsplash.com/photo-1544967082-d9d25d867d66?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80" },
                        { title:"Nearby Parks", desc:"Numerous beautiful parks allow you to roam freely in nature even in the city. Each park has its own characteristics.", image:"https://images.unsplash.com/photo-1505228395891-9a51e7e86bf6?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80" },
                        { title:"Local Food Tour", desc:"Seasonal delicacies and major food festivals. Tarot readings and cocktails nights at Horizon's bar every Thursday.", image:"https://images.unsplash.com/photo-1559339352-11d035aa65de?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80" }
                    ]
                },
                menu: [
                    { text:"Home", url:"#home" }, { text:"About", url:"#about" }, { text:"Gallery", url:"#gallery" }, { text:"Services", url:"#services" }, { text:"Contact", url:"#contact" }
                ],
                settings: {
                    primaryColor:"#c9a86c", fontFamily:"'Inter', sans-serif", maxGuests:12,
                    adminEmail:"", emailjsPublic:"", emailjsService:"", emailjsTemplate:"",
                    social:{ instagram:"#", facebook:"#" }
                },
                footer: {
                    copyright:"Â© 2026 Horizon Luxury Living. All rights reserved.",
                    address:"123 Luxury Avenue, New York, NY 10001",
                    phone:"+1 (212) 555-7890",
                    email:"stay@horizonluxury.com"
                },
                availability: {}
            };

            let siteData = JSON.parse(JSON.stringify(defaultData));
            let reservations = [];

            function mergeDeep(target, source) {
                for(const key in source) {
                    if(source[key] && typeof source[key]==='object' && !Array.isArray(source[key])) {
                        if(!target[key]) target[key]={};
                        mergeDeep(target[key], source[key]);
                    } else target[key]=source[key];
                }
            }

            // Set dynamic default dates (today & tomorrow)
            function setDefaultDates() {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate()+1);
                const fmt = d=>d.toISOString().split('T')[0];
                siteData.hero.checkIn = fmt(today);
                siteData.hero.checkOut = fmt(tomorrow);
            }

            // ---------- LOAD FROM FIREBASE ----------
            async function loadFromFirebase() {
                try {
                    const doc = await contentDoc.get();
                    if(doc.exists) {
                        const saved = doc.data();
                        siteData = JSON.parse(JSON.stringify(defaultData));
                        mergeDeep(siteData, saved);
                    }
                    setDefaultDates(); // always override with current live dates
                    const resSnapshot = await reservationsCol.orderBy('createdAt','desc').get();
                    reservations = resSnapshot.docs.map(doc=>({ id:doc.id, ...doc.data() }));
                    if(siteData.settings.emailjsPublic) initEmailJS(siteData.settings.emailjsPublic);
                } catch(e){ console.error(e); setDefaultDates(); }
                renderSite();
                populateAdminForms();
                updatePreviews();
                renderReservationsList();
                renderCalendar();
                syncBookingBars();
                renderGalleryOrderList();
                // Ensure loader stays at least 4 seconds
                const elapsed = Date.now() - startTime;
                const remaining = Math.max(0, 4000 - elapsed);
                setTimeout(() => {
                    hideLoader();
                }, remaining);
            }

            async function saveToFirebase() {
                await contentDoc.set(siteData);
                if(siteData.settings.emailjsPublic) initEmailJS(siteData.settings.emailjsPublic);
            }

            // ---------- HIDE LOADER ----------
            function hideLoader() {
                const loader = document.getElementById('loader');
                if(loader) {
                    loader.classList.add('fade-out');
                    setTimeout(()=>{ if(loader.parentNode) loader.style.display='none'; }, 500);
                }
            }

            // ---------- SYNC BOOKING BARS ----------
            function syncBookingBars() {
                const dIn = document.getElementById('booking-checkin');
                const dOut = document.getElementById('booking-checkout');
                const dGuests = document.getElementById('booking-guests');
                const mIn = document.getElementById('mobile-booking-checkin');
                const mOut = document.getElementById('mobile-booking-checkout');
                const mGuests = document.getElementById('mobile-booking-guests');
                if(!dIn || !mIn) return;
                const updateMobile = ()=>{ mIn.value = dIn.value; mOut.value = dOut.value; mGuests.value = dGuests.value; };
                const updateDesktop = ()=>{ dIn.value = mIn.value; dOut.value = mOut.value; dGuests.value = mGuests.value; };
                dIn.addEventListener('change', updateMobile);
                dOut.addEventListener('change', updateMobile);
                dGuests.addEventListener('change', updateMobile);
                mIn.addEventListener('change', updateDesktop);
                mOut.addEventListener('change', updateDesktop);
                mGuests.addEventListener('change', updateDesktop);
                updateMobile();
            }

            // ---------- LIGHTBOX ----------
            window.openLightbox = (src) => {
                document.getElementById('lightboxImage').src = src;
                document.getElementById('lightboxModal').style.display = 'flex';
            };
            document.getElementById('lightboxClose').addEventListener('click', ()=>document.getElementById('lightboxModal').style.display='none');
            window.addEventListener('click', e=>{ if(e.target===document.getElementById('lightboxModal')) document.getElementById('lightboxModal').style.display='none'; });

            // ---------- RENDER SITE ----------
            function renderSite() {
                document.getElementById('hero').style.backgroundImage = `linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.2)), url('${siteData.hero.bgImage}')`;
                document.getElementById('hero-subtitle').textContent = siteData.hero.subtitle;
                document.getElementById('hero-title').textContent = siteData.hero.title;
                document.getElementById('hero-text').textContent = siteData.hero.text;
                document.getElementById('booking-checkin').value = siteData.hero.checkIn;
                document.getElementById('booking-checkout').value = siteData.hero.checkOut;
                populateGuestDropdown(siteData.settings.maxGuests);
                // mobile guests
                const mg = document.getElementById('mobile-booking-guests');
                if(mg) {
                    mg.innerHTML = '';
                    for(let i=1;i<=siteData.settings.maxGuests;i++) {
                        let opt = document.createElement('option');
                        opt.value = i; opt.textContent = i+(i===1?' Guest':' Guests');
                        mg.appendChild(opt);
                    }
                    mg.value = 2;
                }
                // nav menu
                const nav = document.getElementById('nav-menu');
                nav.innerHTML = '';
                siteData.menu.forEach(item=>{
                    let li = document.createElement('li');
                    let a = document.createElement('a');
                    a.href = item.url; a.textContent = item.text;
                    li.appendChild(a); nav.appendChild(li);
                });

                const displayed = siteData.gallery.slice(0,9);
                const main = document.getElementById('main-content');
                main.innerHTML = `
                    <section class="container" id="about">
                        <div class="about-grid">
                            <div class="about-content"><h3>${siteData.about.title}</h3><p>${siteData.about.desc1}</p><p>${siteData.about.desc2}</p></div>
                            <div class="about-image"><img src="${siteData.about.image}" alt="About"></div>
                        </div>
                    </section>
                    <section class="container" id="gallery">
                        <div class="section-title"><div class="subtitle">Our Space</div><h2>Gallery</h2></div>
                        <div class="gallery-grid" id="galleryGrid">
                            ${displayed.map(item=>`<div class="gallery-card" onclick="openLightbox('${item.image}')"><img src="${item.image}" alt="${item.title}"></div>`).join('')}
                        </div>
                        <div class="gallery-plus-container"><div class="gallery-plus" id="viewAllGallery"><i class="fas fa-plus"></i></div></div>
                    </section>
                    <section class="dining">
                        <div class="container"><div class="dining-grid">
                            <div class="dining-image"><img src="${siteData.dining.image}" alt="Dining"></div>
                            <div class="dining-content"><h3>${siteData.dining.title}</h3><p>${siteData.dining.desc}</p></div>
                        </div></div>
                    </section>
                    <section class="container" id="services">
                        <div class="section-title"><div class="subtitle">Our Services</div><h2>All you need to know</h2></div>
                        <div class="services-grid">${siteData.services.map(s=>`<div class="service-card"><i class="${s.icon}"></i><h3>${s.title}</h3><p>${s.desc}</p></div>`).join('')}</div>
                    </section>
                    <section class="testimonials">
                        <div class="container">
                            <div class="section-title"><div class="subtitle">High standards</div><h2>What Our Guests Say</h2></div>
                            <div class="testimonials-carousel">
                                <button class="carousel-arrow left" id="testimonialPrev"><i class="fas fa-chevron-left"></i></button>
                                <div class="testimonials-track" id="testimonialTrack">${siteData.testimonials.map(t=>`<div class="testimonial-card"><i class="fas fa-quote-left"></i><p>${t.text}</p><div class="testimonial-author">â€” ${t.author}</div></div>`).join('')}</div>
                                <button class="carousel-arrow right" id="testimonialNext"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                    </section>
                    <section class="container">
                        <div class="section-title"><div class="subtitle">Local Tours</div><h2>${siteData.tours.title}</h2><p>${siteData.tours.desc}</p></div>
                        <div class="tours-grid">${siteData.tours.items.map(t=>`<div class="tour-card"><img src="${t.image}" alt="${t.title}"><div class="tour-info"><h4>${t.title}</h4><p>${t.desc}</p></div></div>`).join('')}</div>
                    </section>
                `;
                document.getElementById('viewAllGallery').addEventListener('click', openFullGallery);
                // testimonial arrows
                const track = document.getElementById('testimonialTrack');
                if(track) {
                    document.getElementById('testimonialPrev').addEventListener('click',()=>track.scrollBy({left:-300,behavior:'smooth'}));
                    document.getElementById('testimonialNext').addEventListener('click',()=>track.scrollBy({left:300,behavior:'smooth'}));
                }
                // footer
                document.getElementById('footer-grid').innerHTML = `
                    <div class="footer-col"><h4>Horizon</h4><p>Luxury boutique apartment in the heart of the city.</p></div>
                    <div class="footer-col"><h4>Contact</h4><p><i class="fas fa-map-marker-alt"></i> <a href="https://maps.google.com/?q=${encodeURIComponent(siteData.footer.address)}" target="_blank">${siteData.footer.address}</a></p><p><i class="fas fa-phone"></i> ${siteData.footer.phone}</p><p><i class="fas fa-envelope"></i> ${siteData.footer.email}</p></div>
                    <div class="footer-col"><h4>Quick Links</h4>${siteData.menu.map(item=>`<p><a href="${item.url}">${item.text}</a></p>`).join('')}</div>
                `;
                document.getElementById('copyright').textContent = siteData.footer.copyright;
                // social tiles
                const insta = document.querySelector('.premium-social-tile.instagram');
                const fb = document.querySelector('.premium-social-tile.facebook');
                if(insta) insta.href = siteData.settings.social?.instagram || '#';
                if(fb) fb.href = siteData.settings.social?.facebook || '#';
            }

            function populateGuestDropdown(max) {
                const sel = document.getElementById('booking-guests');
                if(!sel) return;
                sel.innerHTML = '';
                for(let i=1;i<=max;i++) {
                    let opt = document.createElement('option');
                    opt.value = i; opt.textContent = i+(i===1?' Guest':' Guests');
                    sel.appendChild(opt);
                }
                sel.value = 2;
            }

            // ---------- ADMIN FORM POPULATION ----------
            function populateAdminForms() {
                document.getElementById('hero-subtitle-input').value = siteData.hero.subtitle;
                document.getElementById('hero-title-input').value = siteData.hero.title;
                document.getElementById('hero-text-input').value = siteData.hero.text;
                document.getElementById('hero-bg-input').value = siteData.hero.bgImage;
                document.getElementById('hero-checkin-input').value = siteData.hero.checkIn;
                document.getElementById('hero-checkout-input').value = siteData.hero.checkOut;

                document.getElementById('about-title-input').value = siteData.about.title;
                document.getElementById('about-desc1-input').value = siteData.about.desc1;
                document.getElementById('about-desc2-input').value = siteData.about.desc2;
                document.getElementById('about-image-input').value = siteData.about.image;

                // Gallery tab
                const galleryList = document.getElementById('gallery-list');
                if(galleryList) {
                    galleryList.innerHTML = '';
                    siteData.gallery.forEach((item,idx)=>{
                        const div = document.createElement('div'); div.className = 'thumbnail-item';
                        div.innerHTML = `
                            <div style="flex:1">
                                <div class="image-upload-row"><input type="text" value="${item.title}" placeholder="Title" class="gallery-title" data-index="${idx}"></div>
                                <div class="image-upload-row"><input type="text" value="${item.desc}" placeholder="Description" class="gallery-desc" data-index="${idx}"></div>
                                <div class="image-upload-row">
                                    <input type="url" value="${item.image}" placeholder="Image URL" class="gallery-image" data-index="${idx}">
                                    <button class="upload-btn" onclick="window.uploadGalleryImage(${idx})">Upload</button>
                                </div>
                            </div>
                            <img class="image-preview" id="gallery-preview-${idx}" src="${item.image}" style="display:${item.image?'block':'none'};">
                            <button onclick="window.removeGalleryImage(${idx})"><i class="fas fa-times"></i></button>
                        `;
                        galleryList.appendChild(div);
                    });
                }

                document.getElementById('pricing-basePrice').value = siteData.pricing[0]?.basePrice||0;
                document.getElementById('pricing-maxGuests').value = siteData.pricing[0]?.maxGuests||2;
                document.getElementById('pricing-extraFee').value = siteData.pricing[0]?.extraGuestFee||0;

                document.getElementById('dining-title-input').value = siteData.dining.title;
                document.getElementById('dining-desc-input').value = siteData.dining.desc;
                document.getElementById('dining-image-input').value = siteData.dining.image;

                // Services
                const servicesList = document.getElementById('services-list');
                if(servicesList) {
                    servicesList.innerHTML = '';
                    siteData.services.forEach((s,idx)=>{
                        const div = document.createElement('div'); div.className = 'thumbnail-item';
                        div.innerHTML = `
                            <div style="flex:1">
                                <div class="image-upload-row"><input type="text" value="${s.icon}" placeholder="Icon class" class="service-icon" data-index="${idx}"></div>
                                <div class="image-upload-row"><input type="text" value="${s.title}" placeholder="Title" class="service-title" data-index="${idx}"></div>
                                <div class="image-upload-row"><input type="text" value="${s.desc}" placeholder="Description" class="service-desc" data-index="${idx}"></div>
                            </div>
                            <button onclick="window.removeService(${idx})"><i class="fas fa-times"></i></button>
                        `;
                        servicesList.appendChild(div);
                    });
                }
                // Testimonials
                const testList = document.getElementById('testimonials-list');
                if(testList) {
                    testList.innerHTML = '';
                    siteData.testimonials.forEach((t,idx)=>{
                        const div = document.createElement('div'); div.className = 'thumbnail-item';
                        div.innerHTML = `
                            <div style="flex:1">
                                <div class="image-upload-row"><textarea placeholder="Testimonial text" class="test-text" data-index="${idx}">${t.text}</textarea></div>
                                <div class="image-upload-row"><input type="text" value="${t.author}" placeholder="Author" class="test-author" data-index="${idx}"></div>
                            </div>
                            <button onclick="window.removeTestimonial(${idx})"><i class="fas fa-times"></i></button>
                        `;
                        testList.appendChild(div);
                    });
                }
                // Tours
                document.getElementById('tours-title-input').value = siteData.tours.title;
                document.getElementById('tours-desc-input').value = siteData.tours.desc;
                const toursList = document.getElementById('tours-list');
                if(toursList) {
                    toursList.innerHTML = '';
                    siteData.tours.items.forEach((t,idx)=>{
                        const div = document.createElement('div'); div.className = 'thumbnail-item';
                        div.innerHTML = `
                            <div style="flex:1">
                                <div class="image-upload-row"><input type="text" value="${t.title}" placeholder="Title" class="tour-title" data-index="${idx}"></div>
                                <div class="image-upload-row"><input type="text" value="${t.desc}" placeholder="Description" class="tour-desc" data-index="${idx}"></div>
                                <div class="image-upload-row">
                                    <input type="url" value="${t.image}" placeholder="Image URL" class="tour-image" data-index="${idx}">
                                    <button class="upload-btn" onclick="window.uploadTourImage(${idx})">Upload</button>
                                </div>
                            </div>
                            <img class="image-preview" id="tour-preview-${idx}" src="${t.image}" style="display:${t.image?'block':'none'};">
                            <button onclick="window.removeTour(${idx})"><i class="fas fa-times"></i></button>
                        `;
                        toursList.appendChild(div);
                    });
                }
                // Menu
                const menuList = document.getElementById('menu-list');
                if(menuList) {
                    menuList.innerHTML = '';
                    siteData.menu.forEach((m,idx)=>{
                        const div = document.createElement('div'); div.className = 'thumbnail-item';
                        div.innerHTML = `
                            <div style="flex:1">
                                <div class="image-upload-row"><input type="text" value="${m.text}" placeholder="Text" class="menu-text" data-index="${idx}"></div>
                                <div class="image-upload-row"><input type="text" value="${m.url}" placeholder="URL" class="menu-url" data-index="${idx}"></div>
                            </div>
                            <button onclick="window.removeMenuItem(${idx})"><i class="fas fa-times"></i></button>
                        `;
                        menuList.appendChild(div);
                    });
                }
                // Settings
                document.getElementById('settings-color').value = siteData.settings.primaryColor;
                document.getElementById('settings-font').value = siteData.settings.fontFamily;
                document.getElementById('settings-maxGuests').value = siteData.settings.maxGuests;
                document.getElementById('settings-adminEmail').value = siteData.settings.adminEmail||'';
                document.getElementById('settings-emailjs-public').value = siteData.settings.emailjsPublic||'';
                document.getElementById('settings-emailjs-service').value = siteData.settings.emailjsService||'';
                document.getElementById('settings-emailjs-template').value = siteData.settings.emailjsTemplate||'';
                document.getElementById('settings-social-instagram').value = siteData.settings.social?.instagram||'#';
                document.getElementById('settings-social-facebook').value = siteData.settings.social?.facebook||'#';

                // Footer
                document.getElementById('copyright-input').value = siteData.footer.copyright;
                document.getElementById('footer-address').value = siteData.footer.address;
                document.getElementById('footer-phone').value = siteData.footer.phone;
                document.getElementById('footer-email').value = siteData.footer.email;

                renderGalleryOrderList();
                updatePreviews();
            }

            function updatePreviews() {
                const heroBg = document.getElementById('hero-bg-input').value;
                const hp = document.getElementById('hero-bg-preview');
                if(heroBg) { hp.src=heroBg; hp.style.display='block'; } else hp.style.display='none';
                const aboutImg = document.getElementById('about-image-input').value;
                const ap = document.getElementById('about-image-preview');
                if(aboutImg) { ap.src=aboutImg; ap.style.display='block'; } else ap.style.display='none';
                const diningImg = document.getElementById('dining-image-input').value;
                const dp = document.getElementById('dining-image-preview');
                if(diningImg) { dp.src=diningImg; dp.style.display='block'; } else dp.style.display='none';
            }

            // ---------- UPLOAD / REMOVE HELPERS ----------
            window.uploadGalleryImage = async (index) => {
                const input = document.createElement('input');
                input.type='file'; input.accept='image/*';
                input.onchange = async (e)=>{
                    const file = e.target.files[0]; if(!file) return;
                    try {
                        const url = await uploadImage(file, 'gallery');
                        const imgInput = document.querySelector(`.gallery-image[data-index="${index}"]`);
                        if(imgInput) imgInput.value = url;
                        const preview = document.getElementById(`gallery-preview-${index}`);
                        if(preview) { preview.src=url; preview.style.display='block'; }
                    } catch(err) { alert('Upload failed: '+err); }
                };
                input.click();
            };
            window.removeGalleryImage = (index) => { siteData.gallery.splice(index,1); populateAdminForms(); };
            window.uploadTourImage = async (index) => {
                const input = document.createElement('input');
                input.type='file'; input.accept='image/*';
                input.onchange = async (e)=>{
                    const file = e.target.files[0]; if(!file) return;
                    try {
                        const url = await uploadImage(file, 'tours');
                        const tourInput = document.querySelector(`.tour-image[data-index="${index}"]`);
                        if(tourInput) tourInput.value = url;
                        const preview = document.getElementById(`tour-preview-${index}`);
                        if(preview) { preview.src=url; preview.style.display='block'; }
                    } catch(err) { alert('Upload failed: '+err); }
                };
                input.click();
            };
            window.removeService = (index) => { siteData.services.splice(index,1); populateAdminForms(); };
            window.removeTestimonial = (index) => { siteData.testimonials.splice(index,1); populateAdminForms(); };
            window.removeTour = (index) => { siteData.tours.items.splice(index,1); populateAdminForms(); };
            window.removeMenuItem = (index) => { siteData.menu.splice(index,1); populateAdminForms(); };
            async function uploadImage(file, folder) {
                return new Promise((resolve,reject)=>{
                    const storageRef = storage.ref();
                    const imageRef = storageRef.child(folder+'/'+Date.now()+'_'+file.name);
                    const uploadTask = imageRef.put(file);
                    uploadTask.on('state_changed', null, err=>reject(err), async ()=>resolve(await uploadTask.snapshot.ref.getDownloadURL()));
                });
            }

            // ---------- GALLERY ORDER DRAG & DROP ----------
            let draggedIndex = null;
            function handleDragStart(e) {
                const item = e.target.closest('.gallery-order-item');
                if(!item) return;
                draggedIndex = item.dataset.index;
                e.dataTransfer.setData('text/plain', draggedIndex);
                e.dataTransfer.effectAllowed = 'move';
            }
            function handleDragOver(e) { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; }
            function handleDrop(e) {
                e.preventDefault();
                const target = e.target.closest('.gallery-order-item');
                if(!target) return;
                const targetIndex = target.dataset.index;
                if(draggedIndex===null || draggedIndex===targetIndex) return;
                const newGallery = [...siteData.gallery];
                const [removed] = newGallery.splice(draggedIndex,1);
                newGallery.splice(targetIndex,0,removed);
                siteData.gallery = newGallery;
                populateAdminForms(); // re-render gallery tab and order list
                draggedIndex = null;
            }
            function handleDragEnd() { draggedIndex = null; }
            function renderGalleryOrderList() {
                const container = document.getElementById('gallery-order-list');
                if(!container) return;
                container.innerHTML = '';
                siteData.gallery.forEach((item,index)=>{
                    const div = document.createElement('div');
                    div.className = 'gallery-order-item';
                    div.draggable = true;
                    div.dataset.index = index;
                    div.innerHTML = `<span class="drag-handle">â˜°</span><img src="${item.image}" class="thumbnail"><span class="title">${item.title}</span>`;
                    div.addEventListener('dragstart', handleDragStart);
                    div.addEventListener('dragover', handleDragOver);
                    div.addEventListener('drop', handleDrop);
                    div.addEventListener('dragend', handleDragEnd);
                    container.appendChild(div);
                });
            }

            // ---------- BOOKING MODAL (INQUIRY) ----------
            const modal = document.getElementById('bookingModal');
            const closeModal = document.getElementById('closeModal');
            const bookBtn = document.getElementById('book-btn');
            const mobileBookBtn = document.getElementById('mobile-book-btn');
            const bookingForm = document.getElementById('booking-form');
            let currentBooking = {};

            function openBookingModal() {
                const checkin = document.getElementById('booking-checkin').value;
                const checkout = document.getElementById('booking-checkout').value;
                const guests = parseInt(document.getElementById('booking-guests').value);
                if(!checkin||!checkout) { alert('Please select dates'); return; }
                if(new Date(checkin)>=new Date(checkout)) { alert('Check-out must be after check-in'); return; }
                const aptIdx=0; const aptPricing = siteData.pricing[aptIdx];
                if(guests > aptPricing.maxGuests) { alert(`Max guests is ${aptPricing.maxGuests}`); return; }
                let total=0, nights=[], cur=new Date(checkin), end=new Date(checkout);
                while(cur<end) {
                    const d=cur.toISOString().split('T')[0];
                    const price = siteData.availability?.[aptIdx]?.[d]?.price || aptPricing.basePrice;
                    total+=price; nights.push(d);
                    cur.setDate(cur.getDate()+1);
                }
                total += Math.max(0,guests-2)*(aptPricing.extraGuestFee||0);
                currentBooking = { checkin, checkout, guests, total, aptIdx, nights };
                document.getElementById('modal-checkin').value = checkin;
                document.getElementById('modal-checkout').value = checkout;
                document.getElementById('modal-guests').value = guests;
                document.getElementById('modal-total').value = `$${total}`;
                modal.style.display='flex';
            }
            bookBtn.addEventListener('click', openBookingModal);
            mobileBookBtn.addEventListener('click', openBookingModal);
            closeModal.addEventListener('click', ()=>modal.style.display='none');
            window.addEventListener('click', e=>{ if(e.target===modal) modal.style.display='none'; });

            // ---------- EMAIL SENDING FUNCTION ----------
            async function sendAdminEmail(inquiry) {
                if (!siteData.settings.adminEmail || !siteData.settings.emailjsService || !siteData.settings.emailjsTemplate || !emailjsInitialized) {
                    console.warn('EmailJS not fully configured. Email not sent.');
                    return;
                }
                const templateParams = {
                    to_email: siteData.settings.adminEmail,
                    apartment: inquiry.apartmentTitle,
                    checkin: inquiry.checkIn,
                    checkout: inquiry.checkOut,
                    guests: inquiry.guests,
                    total: inquiry.totalPrice,
                    firstName: inquiry.firstName,
                    lastName: inquiry.lastName,
                    email: inquiry.email,
                    phone: inquiry.phone
                };
                try {
                    await emailjs.send(siteData.settings.emailjsService, siteData.settings.emailjsTemplate, templateParams);
                    console.log('Admin email sent successfully.');
                } catch (error) {
                    console.error('Failed to send admin email:', error);
                }
            }

            bookingForm.addEventListener('submit', async (e)=>{
                e.preventDefault();
                const first = document.getElementById('modal-firstname').value.trim();
                const last = document.getElementById('modal-lastname').value.trim();
                const email = document.getElementById('modal-email').value.trim();
                const phone = document.getElementById('modal-phone').value.trim();
                if(!first||!last||!email||!phone) { alert('Please fill all fields'); return; }
                const { checkin, checkout, guests, total, aptIdx } = currentBooking;
                const inquiry = {
                    apartmentIndex: aptIdx,
                    apartmentTitle: siteData.gallery[aptIdx]?.title||'Horizon Suite',
                    checkIn: checkin, checkOut: checkout, guests, totalPrice: total,
                    firstName:first, lastName:last, email, phone,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'inquiry'
                };
                try {
                    await reservationsCol.add(inquiry);
                    const snap = await reservationsCol.orderBy('createdAt','desc').get();
                    reservations = snap.docs.map(d=>({ id:d.id, ...d.data() }));
                    renderReservationsList(); renderCalendar();

                    // Send email notification
                    await sendAdminEmail(inquiry);

                    modal.style.display='none'; alert('Inquiry sent! You will be contacted shortly.');
                    bookingForm.reset();
                } catch(err) { alert('Error: '+err.message); }
            });

            // ---------- RESERVATION ACTIONS ----------
            window.confirmInquiry = async (resId, aptIdx, checkin, checkout) => {
                if(!confirm('Confirm this inquiry? Dates will be blocked.')) return;
                try {
                    let cur = new Date(checkin), end = new Date(checkout);
                    while(cur<end) {
                        const d = cur.toISOString().split('T')[0];
                        if(!siteData.availability) siteData.availability={};
                        if(!siteData.availability[aptIdx]) siteData.availability[aptIdx]={};
                        siteData.availability[aptIdx][d] = { ...siteData.availability[aptIdx][d], available: false };
                        cur.setDate(cur.getDate()+1);
                    }
                    await saveToFirebase();
                    await reservationsCol.doc(resId).update({ status:'confirmed' });
                    const snap = await reservationsCol.orderBy('createdAt','desc').get();
                    reservations = snap.docs.map(d=>({ id:d.id, ...d.data() }));
                    renderReservationsList(); renderCalendar();
                    alert('Inquiry confirmed.');
                } catch(err) { alert('Error: '+err.message); }
            };
            window.declineInquiry = async (resId) => {
                if(!confirm('Decline this inquiry?')) return;
                try { await reservationsCol.doc(resId).delete(); const snap = await reservationsCol.orderBy('createdAt','desc').get(); reservations = snap.docs.map(d=>({ id:d.id, ...d.data() })); renderReservationsList(); alert('Inquiry declined.'); } catch(err) { alert('Error: '+err.message); }
            };
            window.cancelReservation = async (resId, aptIdx, checkin, checkout) => {
                if(!confirm('Cancel confirmed reservation? Dates will become available.')) return;
                try {
                    await reservationsCol.doc(resId).delete();
                    let cur=new Date(checkin), end=new Date(checkout);
                    while(cur<end) {
                        const d=cur.toISOString().split('T')[0];
                        if(siteData.availability?.[aptIdx]?.[d]) delete siteData.availability[aptIdx][d];
                        cur.setDate(cur.getDate()+1);
                    }
                    await saveToFirebase();
                    const snap = await reservationsCol.orderBy('createdAt','desc').get();
                    reservations = snap.docs.map(d=>({ id:d.id, ...d.data() }));
                    renderReservationsList(); renderCalendar();
                    alert('Reservation cancelled.');
                } catch(err) { alert('Error: '+err.message); }
            };

            function renderReservationsList() {
                const container = document.getElementById('reservations-list');
                if(!container) return;
                container.innerHTML = '';
                if(!reservations.length) { container.innerHTML='<p>No reservations or inquiries yet.</p>'; return; }
                reservations.forEach(res=>{
                    const statusClass = res.status==='confirmed'?'status-confirmed':'status-inquiry';
                    const statusText = res.status==='confirmed'?'Confirmed':'Inquiry';
                    const div = document.createElement('div'); div.className='reservation-item';
                    div.innerHTML = `
                        <div class="reservation-details">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                            <strong>${res.apartmentTitle}</strong><br>
                            ${res.checkIn} to ${res.checkOut} Â· ${res.guests} guests Â· $${res.totalPrice}<br>
                            <small>${res.firstName} ${res.lastName} | ${res.email} | ${res.phone}</small>
                        </div>
                        <div class="reservation-actions">
                            ${res.status==='inquiry' ?
                                `<button class="confirm-btn" onclick="window.confirmInquiry('${res.id}',${res.apartmentIndex},'${res.checkIn}','${res.checkOut}')">Confirm</button>
                                 <button onclick="window.declineInquiry('${res.id}')">Decline</button>` :
                                `<button onclick="window.cancelReservation('${res.id}',${res.apartmentIndex},'${res.checkIn}','${res.checkOut}')">Cancel</button>`
                            }
                        </div>
                    `;
                    container.appendChild(div);
                });
            }

            // ---------- CALENDAR ----------
            let currentCalendarDate = new Date();
            function renderCalendar() {
                const aptIdx=0; const year=currentCalendarDate.getFullYear(); const month=currentCalendarDate.getMonth();
                const firstDay=new Date(year,month,1); const lastDay=new Date(year,month+1,0);
                const startDayOfWeek=firstDay.getDay(); const daysInMonth=lastDay.getDate();
                document.getElementById('calendar-month-year').textContent = firstDay.toLocaleDateString('en-US',{month:'long',year:'numeric'});
                let gridHtml=''; const dayLabels=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
                dayLabels.forEach(l=>gridHtml+=`<div style="font-weight:600; text-align:center;">${l}</div>`);
                for(let i=0;i<startDayOfWeek;i++) gridHtml+='<div></div>';
                for(let d=1;d<=daysInMonth;d++) {
                    const dateStr=`${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                    const dayData=siteData.availability?.[aptIdx]?.[dateStr]||{};
                    const available=dayData.available!==false; const price=dayData.price||'';
                    gridHtml+=`<div class="calendar-day"><div class="day-number">${d}</div><label><input type="checkbox" class="cal-available" data-date="${dateStr}" ${available?'checked':''}> Open</label><input type="number" class="cal-price" data-date="${dateStr}" placeholder="Price" value="${price}" min="0" step="1"></div>`;
                }
                document.getElementById('calendar-grid').innerHTML=gridHtml;
            }
            function collectCalendarData() {
                const aptIdx=0; if(!siteData.availability) siteData.availability={}; if(!siteData.availability[aptIdx]) siteData.availability[aptIdx]={};
                document.querySelectorAll('.cal-available').forEach(cb=>{
                    const date=cb.dataset.date; const available=cb.checked;
                    const priceInput=document.querySelector(`.cal-price[data-date="${date}"]`);
                    const price=priceInput?.value?parseFloat(priceInput.value):null;
                    if(!available && price===null) delete siteData.availability[aptIdx][date];
                    else siteData.availability[aptIdx][date]={ available, price };
                });
            }
            document.getElementById('calendar-prev-month')?.addEventListener('click',()=>{ currentCalendarDate.setMonth(currentCalendarDate.getMonth()-1); renderCalendar(); });
            document.getElementById('calendar-next-month')?.addEventListener('click',()=>{ currentCalendarDate.setMonth(currentCalendarDate.getMonth()+1); renderCalendar(); });
            document.getElementById('apply-bulk-pricing')?.addEventListener('click', function() {
                const from = document.getElementById('bulk-from').value;
                const to = document.getElementById('bulk-to').value;
                const price = parseFloat(document.getElementById('bulk-price').value);
                if(!from||!to||isNaN(price)) { alert('Please fill all fields'); return; }
                if(new Date(from)>new Date(to)) { alert('From date must be before To date'); return; }
                const aptIdx=0; if(!siteData.availability) siteData.availability={}; if(!siteData.availability[aptIdx]) siteData.availability[aptIdx]={};
                let cur=new Date(from), end=new Date(to);
                while(cur<=end) {
                    const d=cur.toISOString().split('T')[0];
                    const existing=siteData.availability[aptIdx][d]||{};
                    siteData.availability[aptIdx][d]={ ...existing, price:price };
                    cur.setDate(cur.getDate()+1);
                }
                alert('Bulk pricing applied'); renderCalendar();
            });

            // ---------- ADMIN LOGIN / LOGOUT ----------
            const adminIcon = document.getElementById('adminIcon');
            const adminOverlay = document.getElementById('adminOverlay');
            const loginContainer = document.getElementById('loginContainer');
            const adminDashboard = document.getElementById('adminDashboard');
            adminIcon.addEventListener('click', ()=>{
                if(auth.currentUser) {
                    loginContainer.style.display='none';
                    adminDashboard.style.display='block';
                    adminOverlay.style.display='flex';
                    setTimeout(()=>{ renderCalendar(); renderGalleryOrderList(); },100);
                } else {
                    loginContainer.style.display='block';
                    adminDashboard.style.display='none';
                    adminOverlay.style.display='flex';
                }
            });
            document.getElementById('loginBtn').addEventListener('click', async ()=>{
                const email = document.getElementById('loginEmail').value;
                const pwd = document.getElementById('loginPassword').value;
                try {
                    await auth.signInWithEmailAndPassword(email,pwd);
                    loginContainer.style.display='none';
                    adminDashboard.style.display='block';
                    document.getElementById('loginError').textContent='';
                    renderCalendar(); renderGalleryOrderList();
                } catch(err){ document.getElementById('loginError').textContent=err.message; }
            });
            document.getElementById('logoutBtn').addEventListener('click', async ()=>{
                await auth.signOut();
                adminOverlay.style.display='none';
                loginContainer.style.display='block';
                adminDashboard.style.display='none';
            });
            document.getElementById('closeAdmin').addEventListener('click', ()=>adminOverlay.style.display='none');

            // ---------- SAVE CHANGES ----------
            document.getElementById('saveChanges').addEventListener('click', async ()=>{
                // Gather all fields (simplified but functional)
                // Gallery
                const galleryTitles = document.querySelectorAll('.gallery-title');
                const galleryDescs = document.querySelectorAll('.gallery-desc');
                const galleryImages = document.querySelectorAll('.gallery-image');
                siteData.gallery = Array.from(galleryTitles).map((el,i)=>({
                    title: el.value,
                    desc: galleryDescs[i].value,
                    image: galleryImages[i].value
                }));
                // Pricing
                siteData.pricing[0] = {
                    basePrice: parseFloat(document.getElementById('pricing-basePrice').value)||0,
                    maxGuests: parseInt(document.getElementById('pricing-maxGuests').value)||2,
                    extraGuestFee: parseFloat(document.getElementById('pricing-extraFee').value)||0
                };
                // Hero
                siteData.hero.subtitle = document.getElementById('hero-subtitle-input').value;
                siteData.hero.title = document.getElementById('hero-title-input').value;
                siteData.hero.text = document.getElementById('hero-text-input').value;
                siteData.hero.bgImage = document.getElementById('hero-bg-input').value;
                siteData.hero.checkIn = document.getElementById('hero-checkin-input').value;
                siteData.hero.checkOut = document.getElementById('hero-checkout-input').value;
                // About
                siteData.about.title = document.getElementById('about-title-input').value;
                siteData.about.desc1 = document.getElementById('about-desc1-input').value;
                siteData.about.desc2 = document.getElementById('about-desc2-input').value;
                siteData.about.image = document.getElementById('about-image-input').value;
                // Dining
                siteData.dining.title = document.getElementById('dining-title-input').value;
                siteData.dining.desc = document.getElementById('dining-desc-input').value;
                siteData.dining.image = document.getElementById('dining-image-input').value;
                // Services
                const serviceIcons = document.querySelectorAll('.service-icon');
                const serviceTitles = document.querySelectorAll('.service-title');
                const serviceDescs = document.querySelectorAll('.service-desc');
                siteData.services = Array.from(serviceIcons).map((el,i)=>({
                    icon: el.value,
                    title: serviceTitles[i].value,
                    desc: serviceDescs[i].value
                }));
                // Testimonials
                const testTexts = document.querySelectorAll('.test-text');
                const testAuthors = document.querySelectorAll('.test-author');
                siteData.testimonials = Array.from(testTexts).map((el,i)=>({
                    text: el.value,
                    author: testAuthors[i].value
                }));
                // Tours
                siteData.tours.title = document.getElementById('tours-title-input').value;
                siteData.tours.desc = document.getElementById('tours-desc-input').value;
                const tourTitles = document.querySelectorAll('.tour-title');
                const tourDescs = document.querySelectorAll('.tour-desc');
                const tourImages = document.querySelectorAll('.tour-image');
                siteData.tours.items = Array.from(tourTitles).map((el,i)=>({
                    title: el.value,
                    desc: tourDescs[i].value,
                    image: tourImages[i].value
                }));
                // Menu
                const menuTexts = document.querySelectorAll('.menu-text');
                const menuUrls = document.querySelectorAll('.menu-url');
                siteData.menu = Array.from(menuTexts).map((el,i)=>({
                    text: el.value,
                    url: menuUrls[i].value
                }));
                // Settings
                siteData.settings.primaryColor = document.getElementById('settings-color').value;
                siteData.settings.fontFamily = document.getElementById('settings-font').value;
                siteData.settings.maxGuests = parseInt(document.getElementById('settings-maxGuests').value)||12;
                siteData.settings.adminEmail = document.getElementById('settings-adminEmail').value;
                siteData.settings.emailjsPublic = document.getElementById('settings-emailjs-public').value;
                siteData.settings.emailjsService = document.getElementById('settings-emailjs-service').value;
                siteData.settings.emailjsTemplate = document.getElementById('settings-emailjs-template').value;
                if(!siteData.settings.social) siteData.settings.social={};
                siteData.settings.social.instagram = document.getElementById('settings-social-instagram').value;
                siteData.settings.social.facebook = document.getElementById('settings-social-facebook').value;
                // Footer
                siteData.footer.copyright = document.getElementById('copyright-input').value;
                siteData.footer.address = document.getElementById('footer-address').value;
                siteData.footer.phone = document.getElementById('footer-phone').value;
                siteData.footer.email = document.getElementById('footer-email').value;
                // Calendar
                collectCalendarData();

                await saveToFirebase();
                renderSite();
                alert('Changes saved (including gallery order).');
                adminOverlay.style.display='none';
            });

            // ---------- FULL GALLERY MODAL ----------
            function openFullGallery() {
                const modal = document.getElementById('fullGalleryModal');
                const grid = document.getElementById('fullGalleryGrid');
                grid.innerHTML = siteData.gallery.map(item=>`<img src="${item.image}" onclick="openLightbox('${item.image}')">`).join('');
                modal.style.display='flex';
            }
            document.getElementById('closeFullGallery').addEventListener('click', ()=>document.getElementById('fullGalleryModal').style.display='none');
            document.getElementById('closeFullGalleryBottom').addEventListener('click', ()=>document.getElementById('fullGalleryModal').style.display='none');
            window.addEventListener('click', e=>{ if(e.target===document.getElementById('fullGalleryModal')) document.getElementById('fullGalleryModal').style.display='none'; });

            // ---------- ADD BUTTONS ----------
            document.getElementById('add-gallery-image')?.addEventListener('click', ()=>{
                siteData.gallery.push({ title:'New Image', desc:'', image:'https://via.placeholder.com/600x400?text=New+Image' });
                populateAdminForms();
            });
            document.getElementById('add-service')?.addEventListener('click', ()=>{
                siteData.services.push({ icon:'fas fa-star', title:'New Service', desc:'Description' });
                populateAdminForms();
            });
            document.getElementById('add-testimonial')?.addEventListener('click', ()=>{
                siteData.testimonials.push({ text:'New testimonial', author:'Guest' });
                populateAdminForms();
            });
            document.getElementById('add-tour')?.addEventListener('click', ()=>{
                siteData.tours.items.push({ title:'New Tour', desc:'Description', image:'https://via.placeholder.com/600x400?text=Tour' });
                populateAdminForms();
            });
            document.getElementById('add-menu-item')?.addEventListener('click', ()=>{
                siteData.menu.push({ text:'New Link', url:'#' });
                populateAdminForms();
            });

            // ---------- TAB SWITCHING ----------
            document.querySelectorAll('.admin-tab').forEach(tab=>{
                tab.addEventListener('click', ()=>{
                    document.querySelectorAll('.admin-tab').forEach(t=>t.classList.remove('active'));
                    document.querySelectorAll('.admin-tab-content').forEach(c=>c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById('tab-'+tab.dataset.tab).classList.add('active');
                    if(tab.dataset.tab==='calendar') renderCalendar();
                    if(tab.dataset.tab==='reservations') renderReservationsList();
                    if(tab.dataset.tab==='galleryOrder') renderGalleryOrderList();
                });
            });

            // ---------- UPLOAD BUTTONS (hero, about, dining) ----------
            document.getElementById('upload-hero-bg')?.addEventListener('click', ()=>{
                const input = document.createElement('input');
                input.type='file'; input.accept='image/*';
                input.onchange = async (e)=>{
                    const file = e.target.files[0]; if(!file) return;
                    const btn = document.getElementById('upload-hero-bg');
                    btn.disabled=true; btn.textContent='Uploading...';
                    try {
                        const url = await uploadImage(file, 'hero');
                        document.getElementById('hero-bg-input').value = url;
                        document.getElementById('hero-bg-preview').src = url;
                        document.getElementById('hero-bg-preview').style.display='block';
                    } catch(err) { alert('Upload failed: '+err); }
                    finally { btn.disabled=false; btn.textContent='Upload'; }
                };
                input.click();
            });
            document.getElementById('upload-about-image')?.addEventListener('click', ()=>{
                const input = document.createElement('input');
                input.type='file'; input.accept='image/*';
                input.onchange = async (e)=>{
                    const file = e.target.files[0]; if(!file) return;
                    const btn = document.getElementById('upload-about-image');
                    btn.disabled=true; btn.textContent='Uploading...';
                    try {
                        const url = await uploadImage(file, 'about');
                        document.getElementById('about-image-input').value = url;
                        document.getElementById('about-image-preview').src = url;
                        document.getElementById('about-image-preview').style.display='block';
                    } catch(err) { alert('Upload failed: '+err); }
                    finally { btn.disabled=false; btn.textContent='Upload'; }
                };
                input.click();
            });
            document.getElementById('upload-dining-image')?.addEventListener('click', ()=>{
                const input = document.createElement('input');
                input.type='file'; input.accept='image/*';
                input.onchange = async (e)=>{
                    const file = e.target.files[0]; if(!file) return;
                    const btn = document.getElementById('upload-dining-image');
                    btn.disabled=true; btn.textContent='Uploading...';
                    try {
                        const url = await uploadImage(file, 'dining');
                        document.getElementById('dining-image-input').value = url;
                        document.getElementById('dining-image-preview').src = url;
                        document.getElementById('dining-image-preview').style.display='block';
                    } catch(err) { alert('Upload failed: '+err); }
                    finally { btn.disabled=false; btn.textContent='Upload'; }
                };
                input.click();
            });

            // ---------- iCal (stub) ----------
            document.getElementById('export-ical')?.addEventListener('click', ()=>{ alert('iCal export would be implemented here.'); });
            document.getElementById('import-ical')?.addEventListener('click', ()=>{ alert('iCal import would be implemented here.'); });

            // ---------- START ----------
            loadFromFirebase();
        })();
    </script>
</body>
</html>
